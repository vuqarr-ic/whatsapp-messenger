# STORK

Децентрализованный мессенджер с WebRTC для обмена сообщениями между устройствами.

## Возможности

- ✅ **P2P 1-to-1** — прямое WebRTC соединение между двумя пользователями
- ✅ **Группы до 100 участников** — через сервер сигналов
- ✅ **Фото, видео, документы** — отправка вложений любого размера
- ✅ **Управление группами** — добавление/удаление участников, назначение админов
- ✅ **Контекстное меню** — удаление, переименование, просмотр ID
- ✅ **Локальное хранение** — все данные в браузере

## Установка

```bash
npm install
```

## Запуск

### Локальная разработка (только вкладки одного браузера)

```bash
npm run dev
```

Откройте http://localhost:3000 в двух вкладках.

### Реальное использование (разные устройства/браузеры)

1. Запустите сервер сигналов и приложение:

```bash
npm start
```

2. Откройте http://localhost:3000 в разных браузерах или на разных устройствах в одной сети.

3. Обменяйтесь Peer ID и создайте чаты.

## Работа через интернет (разные устройства, разные сети)

Чтобы мессенджер работал на двух устройствах в разных сетях (телефон + компьютер, разные города и т.п.):

1. Разместите **сервер сигналов** на публичном хостинге (Railway, Render, Fly.io).
2. Разместите **приложение** на Vercel, Netlify или другом хостинге.
3. В настройках деплоя добавьте переменную `VITE_SIGNALING_URL=wss://ваш-сервер-сигналов.com`.

Подробная инструкция: **[DEPLOY.md](./DEPLOY.md)** — пошаговый деплой через Railway и Render.

---

## Деплой в продакшен

### 1. Сборка клиента

```bash
npm run build
```

Файлы будут в `dist/`.

### 2. Сервер сигналов

Разместите `server/index.js` на Node.js-хостинге (Railway, Render, Fly.io и т.п.):

```bash
node server/index.js
```

Порт задаётся переменной `PORT` (по умолчанию 3005).

### 3. Переменные окружения

Создайте `.env` в корне проекта:

```
VITE_SIGNALING_URL=wss://your-signaling-server.com
```

Для локальной разработки:

```
VITE_SIGNALING_URL=ws://localhost:3005
```

### 4. HTTPS

Для работы WebRTC в продакшене нужен HTTPS. Сервер сигналов доступен по `wss://` (WebSocket Secure).

## Как это работает

1. **Signaling** — WebSocket-сервер обменивает WebRTC-сигналами между пирами.
2. **1-to-1** — после обмена сигналами устанавливается прямое P2P-соединение.
3. **Группы** — сообщения передаются через сервер сигналов всем участникам.
4. **Fallback** — при недоступности сервера используется localStorage (работает в одной вкладке/браузере).

## Структура проекта

```
whatsapp-messenger/
├── server/
│   └── index.js          # WebSocket сервер сигналов
├── src/
│   ├── components/       # React компоненты
│   ├── context/          # ChatContext
│   ├── services/
│   │   ├── p2pService.js # WebRTC + localStorage
│   │   └── storageService.js
│   ├── config.js         # URL сервера сигналов
│   └── App.jsx
├── .env.example
└── package.json
```

## Технологии

- React 18 + Vite
- WebRTC (simple-peer)
- WebSocket (ws)
- LocalStorage
